var calledArgs=null;!function(a){a(function(){function b(){a("form").each(function(b){var d=!1;if(!a(this).attr("onsubmit")||a(this).attr("onsubmit").indexOf("procFilter")<0)for(var e=a(this).find("input[name=act]").val(),b=0;b<captchaTargetAct.length;b++)if(captchaTargetAct[b]==e){d=!0;break}d&&(a(this).append('<input type="hidden" name="captchaType" value="inline" />'),a(this).find("input[name=error_return_url]")||a(this).append('<input type="hidden" name="error_return_url" value="'+current_url+'" />'),a(this).submit(function(b){if(a(this).find("input[name=secret_text]").val())return!0;b.preventDefault();var d=this;a("#captcha_layer form").submit(function(b){if(b.preventDefault(),!a("#secret_text").val())return a(this).find("input[type=text]").val("").focus(),!1;a(d).append('<input type="hidden" name="secret_text" value="'+a("#secret_text").val()+'" />'),a(d).submit()});var e=new Array;e.captcha_action="setCaptchaSession",e.mid=current_mid,window.oldExecXml("","",e,c.show,new Array("error","message","about_captcha","captcha_reload","captcha_play","cmd_input","cmd_cancel"))}))});var b=current_url.setQuery("captcha_action","captchaAudio").setQuery("rnd",(new Date).getTime()),d=null,e=null;if(!c){var f="";if(c=a('<div id="captcha_layer" style="position:fixed; top:0; left:0; width:100%; height:100%;display:none;z-index:10">'),c.appendTo(document.body),c.exec=function(b,d,e,f,g,h,i){var j=!1;if(a.each(captchaTargetAct||{},function(a,b){if(b==d)return j=!0,!1}),j){a("#captcha_layer form").submit(function(b){return b.preventDefault(),a("#secret_text").val()?(c.compare(),!1):(a(this).find("input[type=text]").val("").focus(),!1)}),calledArgs={module:b,act:d,params:e,callback_func:f,response_tags:g,callback_func_arg:h,fo_obj:i};var e=new Array;e.captcha_action="setCaptchaSession",e.mid=current_mid,window.oldExecXml(b,d,e,c.show,new Array("error","message","about_captcha","captcha_reload","captcha_play","cmd_input","cmd_cancel"))}else window.oldExecXml(b,d,e,f,g,h,i);return!0},c.show=function(b){a("#captcha_layer").show(),a("#captchaAbout").html(b.about_captcha),a("#captcha_layer .reload").attr("title",b.captcha_reload),a("#captcha_layer .play").attr("title",b.captcha_play),a("#captcha_layer button[type=submit]").html(b.cmd_input),a("#captcha_layer button.cancel").html(b.cmd_cancel),a("#captcha_image").attr("src",current_url.setQuery("captcha_action","captchaImage").setQuery("rnd",(new Date).getTime())),i.find("input[type=text]").val("").focus(),a("html, body").css("height","100%")},c.compare=function(b){var c=new Array;c.captcha_action="captchaCompare",c.mid=current_mid,c.secret_text=a("#secret_text").val(),window.oldExecXml(calledArgs.module,calledArgs.act,c,function(){a("#captcha_layer").hide(),window.oldExecXml(calledArgs.module,calledArgs.act,calledArgs.params,calledArgs.callback_func,calledArgs.response_tags,calledArgs.callback_func_arg,calledArgs.fo_obj)})},c.loadAudio=function(){Modernizr.audio&&Modernizr.audio.mp3&&(b=b.setQuery("rnd",(new Date).getTime()),d||(d=new Audio(b)),d.setAttribute("src",b),d.load())},c.playAudio=function(){i.find("input[type=text]").focus(),Modernizr.audio&&Modernizr.audio.mp3?(c.loadAudio(),d.play()):(e||(e=document.querySelector("#captcha_audio_flash")),e&&"function"==typeof e.setSoundTarget&&(b=b.setQuery("rnd",(new Date).getTime()),e.setSoundTarget(b,"1")))},!Modernizr.audio||!Modernizr.audio.mp3){var g=request_uri+"addons/captcha/swf/play.swf";f=[],f.push('<object id="captcha_audio_flash" width="0" height="0" type="application/x-shockwave-flash" data="'+g+'">'),f.push('<param name="movie" value="'+g+'" />'),f.push('<param name="allowScriptAccess" value="always" />'),f.push('<param name="quality" value="high" />'),f.push('<param name="wmode" value="transparent" />'),f.push("</object>"),f=f.join("")}var h="margin:-105px 0 0 -105px; top:50%; left:50%;";screen.width<480&&(h="");var i=a('<div style="z-index:1000;position:absolute; width:310px;'+h+' background:#fff; border:3px solid #ccc;"><form method="post" action=""><div style="position:relative; margin:25px 20px 15px 20px"><img src="about:blank" id="captcha_image" alt="CAPTCHA" width="240" height="50" style="display:block; width:240px; height:50px; border:1px solid #b0b0b0" /><button type="button" class="reload" title="" style="position:absolute; top:0; left:245px; width:25px; height:25px; padding:0; overflow:visible; border:1px solid #575757; background:#747474 url('+request_uri+'addons/captcha/img/icon.gif) no-repeat center 5px;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px; cursor:pointer;box-shadow:0 0 3px #444 inset;-moz-box-shadow:0 0 3px #444 inset;-webkit-box-shadow:0 0 3px #444 inset;"></button><button type="button" class="play" title="" style="position:absolute; top:27px; left:245px; width:25px; height:25px; padding:0; overflow:visible; border:1px solid #575757; background:#747474 url('+request_uri+'addons/captcha/img/icon.gif) no-repeat center -20px;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px; cursor:pointer;box-shadow:0 0 3px #444 inset;-moz-box-shadow:0 0 3px #444 inset;-webkit-box-shadow:0 0 3px #444 inset;"></button></div><label id="captchaAbout" for="captcha" style="display:block; border-top:1px dashed #c5c5c5; padding:15px 0; margin:0 20px; font-size:12px; color:#5f5f5f;"></label><input name="" type="text" id="secret_text" style="ime-mode:inactive;margin:0 20px; width:232px; border:1px solid #bdbdbd; padding:3px 4px; font-size:18px; font-weight:bold;" /><div style="margin:20px; border-top:1px dashed #c5c5c5; padding:15px 0 0 0; text-align:center"><button type="submit" style="height:31px; line-height:31px; padding:0 15px; margin:0 2px; font-size:12px; font-weight:bold; color:#fff; overflow:visible; border:1px solid #5c8a16; background:#6faa13;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px; cursor:pointer;box-shadow:0 0 3px #666 inset;-moz-box-shadow:0 0 3px #666 inset;-webkit-box-shadow:0 0 3px #666 inset;"></button><button type="button" class="cancel" style="height:31px; line-height:31px; padding:0 15px; margin:0 2px; font-size:12px; font-weight:bold; color:#fff; overflow:visible; border:1px solid #575757; background:#747474;border-radius:3px;-moz-border-radius:3px;-webkit-border-radius:3px; cursor:pointer;box-shadow:0 0 3px #444 inset;-moz-box-shadow:0 0 3px #444 inset;-webkit-box-shadow:0 0 3px #444 inset;"></button></div></form>'+f+"</div>").appendTo(c);i.find("button.cancel").click(function(){a("#captcha_layer").hide()}),i.find("button.play").click(c.playAudio),i.find("button.reload").click(function(){var b=new Array;b.captcha_action="setCaptchaSession",b.mid=current_mid,window.oldExecXml("","",b,function(){a("#captcha_image").attr("src",current_url.setQuery("captcha_action","captchaImage").setQuery("rnd",(new Date).getTime())),d&&c.loadAudio()})})}return c}var c=null;a(window).ready(function(){window.oldExecXml||(window.oldExecXml=window.exec_xml,window.exec_xml=b().exec)})})}(jQuery);